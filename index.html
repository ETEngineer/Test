<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DST Visualization – CodeSandbox Dark</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
  <style>
    :root {
      --bg: #1e1f26;
      --panel: #2c2d35;
      --accent: #3ea6ff;
      --text: #e0e0e0;
      --subtext: #9aa0ac;
      --border: #3a3b44;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      margin: 0;
      min-height: 100vh;
    }
    h2 {
      color: var(--accent);
      margin: 0.5rem 0 1rem 0;
      text-align: center;
      font-size: 1.3rem;
    }
    .controls {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    input[type="file"],
    input[type="date"],
    button {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
    }
    button {
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #4db5ff;
    }
    canvas {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      width: 100%;
      max-width: 1100px;
      height: 450px;
    }
    @media (max-width: 600px) {
      h2 { font-size: 1.1rem; }
      canvas { height: 350px; }
    }
  </style>
</head>
<body>
  <h2>Time Comparison (Calendar · ZonedDateTime · Canada/Central)</h2>
  <div class="controls">
    <input type="file" id="fileInput" accept=".txt" />
    <label>From: <input type="date" id="startDate"></label>
    <label>To: <input type="date" id="endDate"></label>
    <button id="applyRange">Apply</button>
  </div>

  <canvas id="timeChart"></canvas>

  <script>
    const ctx = document.getElementById("timeChart").getContext("2d");
    let chart, allData = [];

    document.getElementById("fileInput").addEventListener("change", e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        const lines = reader.result.trim().split("\n");
        allData = lines.map(line => {
          const [calStr, zonStr, canStr] = line.split(",");
          return {
            calendar: new Date(calStr),
            zoned: new Date(zonStr),
            central: new Date(canStr)
          };
        });
        plotChart(allData);
      };
      reader.readAsText(file);
    });

    document.getElementById("applyRange").addEventListener("click", () => {
      const start = document.getElementById("startDate").value
        ? new Date(document.getElementById("startDate").value)
        : null;
      const end = document.getElementById("endDate").value
        ? new Date(document.getElementById("endDate").value)
        : null;
      const filtered = allData.filter(d =>
        (!start || d.calendar >= start) && (!end || d.calendar <= end)
      );
      plotChart(filtered);
    });

    function plotChart(data) {
      if (chart) chart.destroy();

      const calendarData = data.map(d => ({ x: d.calendar, y: d.calendar }));
      const zonedData = data.map(d => ({ x: d.calendar, y: d.zoned }));
      const centralData = data.map(d => ({ x: d.calendar, y: d.central }));

      chart = new Chart(ctx, {
        type: "line",
        data: {
          datasets: [
            {
              label: "Calendar Time",
              data: calendarData,
              borderColor: "#ff6b81",
              borderWidth: 2,
              tension: 0.25,
              pointRadius: 0
            },
            {
              label: "ZonedDateTime",
              data: zonedData,
              borderColor: "#3ea6ff",
              borderWidth: 2,
              tension: 0.25,
              pointRadius: 0
            },
            {
              label: "Canada/Central Converted",
              data: centralData,
              borderColor: "#4ad991",
              borderWidth: 2,
              tension: 0.25,
              pointRadius: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              type: "time",
              time: {
                tooltipFormat: "MMM dd, HH:mm",
                displayFormats: {
                  hour: "MMM dd HH:mm"
                }
              },
              title: { display: true, text: "Timeline", color: "#b0b0b0" },
              ticks: { color: "#ccc" },
              grid: { color: "rgba(255,255,255,0.08)" }
            },
            y: {
              type: "time",
              time: {
                unit: "hour",
                tooltipFormat: "HH:mm",
                displayFormats: { hour: "HH:mm" }
              },
              title: { display: true, text: "Local Time (HH:mm)", color: "#b0b0b0" },
              ticks: { color: "#ccc" },
              grid: { color: "rgba(255,255,255,0.08)" }
            }
          },
          plugins: {
            legend: { position: "top", labels: { color: "#ddd" } },
            title: {
              display: true,
              text: "DST Visualization",
              color: "#3ea6ff",
              font: { size: 16, weight: "bold" }
            },
            tooltip: {
              backgroundColor: "#2a2a33",
              borderColor: "#3ea6ff",
              borderWidth: 1,
              titleColor: "#fff",
              bodyColor: "#ccc",
              callbacks: {
                label: ctx => {
                  const d = new Date(ctx.raw.y);
                  return `${ctx.dataset.label}: ${d.toLocaleString()}`;
                }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
